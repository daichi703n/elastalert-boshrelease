---
name: elastalert

templates:
  bin/ctl.sh: bin/ctl
  bin/pre-start.sh: bin/pre-start
  bin/ctl_utils.sh: bin/ctl_utils.sh
  bin/elastalert-test-rule.sh: bin/elastalert-test-rule.sh
  config/config.yml: config/config.yml
  config/smtp_auth_file.yml: config/smtp_auth_file.yml

consumes:
- name: elasticsearch
  type: elasticsearch
  optional: true

packages:
- elastalert
- python2.7

properties:
  elastalert.rules_folder:
    description: "The name of the folder which contains rule configuration files."
    default: "/var/vcap/jobs/elastalert/rules"
  elastalert.run_every:
    description: "how often ElastAlert will query Elasticsearch."
    default: 
      minutes: 1
  elastalert.buffer_time:
    description: "the size of the query window, stretching backwards from the time each query is run."
    default: 
      minutes: 15
  elastalert.es_host:
    description: "the address of an Elasticsearch cluster where ElastAlert will store data about its state, queries run, alerts, and errors."
    default: "localhost"
  elastalert.es_port:
    description: " the port corresponding to es_host."
    default: "9200"
  elastalert.writeback_index:
    description: "the name of the index in which ElastAlert will store data."
    default: "elastalert_status"
  elastalert.alert_time_limit:
    description: "the retry window for failed alerts."
    default:
      days: 2
  elastalert.smtp_host:
    description: "The SMTP host used to send email notifications. This value will be used for email alerts as well, unless overwritten in the rule config."
    default: "localhost"
  elastalert.smtp_port:
    description: "The port to use."
    default: 25
  elastalert.from_addr:
    description: The address to use as the from header in email notifications. This value will be used for email alerts as well, unless overwritten in the rule config."
    default: "ElastAlert"
  elastalert.smtp_user:
    description: "username for smtp authentication."
    default: ""
  elastalert.smtp_password:
    description: "password for smtp authentication."
    default: ""
  elastalert.rules:
    description: "List of ElastAlert rules"
    example: |
      - name: Example rule
        type: frequency
        index: logstash-*
        num_events: 50
        timeframe:
            hours: 4
        filter:
        - term:
            some_field: "some_value"
        alert:
        - "email"
        email:
        - "elastalert@example.com"
